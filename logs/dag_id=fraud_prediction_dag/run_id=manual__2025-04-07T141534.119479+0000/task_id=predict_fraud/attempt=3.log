[2025-04-07T14:21:03.422+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: fraud_prediction_dag.predict_fraud manual__2025-04-07T14:15:34.119479+00:00 [queued]>
[2025-04-07T14:21:03.426+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: fraud_prediction_dag.predict_fraud manual__2025-04-07T14:15:34.119479+00:00 [queued]>
[2025-04-07T14:21:03.427+0000] {taskinstance.py:2170} INFO - Starting attempt 3 of 4
[2025-04-07T14:21:03.441+0000] {taskinstance.py:2191} INFO - Executing <Task(PythonOperator): predict_fraud> on 2025-04-07 14:15:34.119479+00:00
[2025-04-07T14:21:03.444+0000] {standard_task_runner.py:60} INFO - Started process 554 to run task
[2025-04-07T14:21:03.446+0000] {standard_task_runner.py:87} INFO - Running: ['airflow', 'tasks', 'run', 'fraud_prediction_dag', 'predict_fraud', 'manual__2025-04-07T14:15:34.119479+00:00', '--job-id', '12', '--raw', '--subdir', 'DAGS_FOLDER/fraud_pipeline_dag.py', '--cfg-path', '/tmp/tmpkc8c9iiy']
[2025-04-07T14:21:03.447+0000] {standard_task_runner.py:88} INFO - Job 12: Subtask predict_fraud
[2025-04-07T14:21:03.474+0000] {task_command.py:423} INFO - Running <TaskInstance: fraud_prediction_dag.predict_fraud manual__2025-04-07T14:15:34.119479+00:00 [running]> on host edc87b335a79
[2025-04-07T14:21:03.515+0000] {taskinstance.py:2480} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='airflow' AIRFLOW_CTX_DAG_ID='fraud_prediction_dag' AIRFLOW_CTX_TASK_ID='predict_fraud' AIRFLOW_CTX_EXECUTION_DATE='2025-04-07T14:15:34.119479+00:00' AIRFLOW_CTX_TRY_NUMBER='3' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-04-07T14:15:34.119479+00:00'
[2025-04-07T14:21:22.064+0000] {logging_mixin.py:188} INFO - STDOUT:
[2025-04-07T14:21:22.065+0000] {logging_mixin.py:188} INFO -  
[2025-04-07T14:21:22.065+0000] {logging_mixin.py:188} WARNING - STDERR:
[2025-04-07T14:21:22.066+0000] {logging_mixin.py:188} WARNING -  /home/airflow/.local/lib/python3.8/site-packages/xgboost/core.py:158: UserWarning: [14:21:10] WARNING: /workspace/src/collective/../data/../common/error_msg.h:80: If you are loading a serialized model (like pickle in Python, RDS in R) or
configuration generated by an older version of XGBoost, please export the model by calling
`Booster.save_model` from that version first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/stable/tutorials/saving_model.html

for more details about differences between saving model and serializing.

  warnings.warn(smsg, UserWarning)
/home/airflow/.local/lib/python3.8/site-packages/sklearn/base.py:348: InconsistentVersionWarning: Trying to unpickle estimator LabelEncoder from version 1.5.1 when using version 1.3.2. This might lead to breaking code or invalid results. Use at your own risk. For more info please refer to:
https://scikit-learn.org/stable/model_persistence.html#security-maintainability-limitations
  warnings.warn(
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/sklearn/utils/_encode.py", line 225, in _encode
    return _map_to_integer(values, uniques)
  File "/home/airflow/.local/lib/python3.8/site-packages/sklearn/utils/_encode.py", line 165, in _map_to_integer
    return np.array([table[v] for v in values])
  File "/home/airflow/.local/lib/python3.8/site-packages/sklearn/utils/_encode.py", line 165, in <listcomp>
    return np.array([table[v] for v in values])
  File "/home/airflow/.local/lib/python3.8/site-packages/sklearn/utils/_encode.py", line 159, in __missing__
    raise KeyError(key)
KeyError: 'Mika'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/airflow/dags/predict_new.py", line 38, in <module>
    df['nameOrig'] = encoders['nameOrig'].transform(df['nameOrig_raw'])
  File "/home/airflow/.local/lib/python3.8/site-packages/sklearn/preprocessing/_label.py", line 137, in transform
    return _encode(y, uniques=self.classes_)
  File "/home/airflow/.local/lib/python3.8/site-packages/sklearn/utils/_encode.py", line 227, in _encode
    raise ValueError(f"y contains previously unseen labels: {str(e)}")
ValueError: y contains previously unseen labels: 'Mika'
[2025-04-07T14:21:22.067+0000] {taskinstance.py:2698} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/models/taskinstance.py", line 433, in _execute_task
    result = execute_callable(context=context, **execute_callable_kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 199, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 216, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/fraud_pipeline_dag.py", line 24, in run_prediction
    raise Exception("⚠️ predict_new.py завершился с ошибкой")
Exception: ⚠️ predict_new.py завершился с ошибкой
[2025-04-07T14:21:22.072+0000] {taskinstance.py:1138} INFO - Marking task as UP_FOR_RETRY. dag_id=fraud_prediction_dag, task_id=predict_fraud, execution_date=20250407T141534, start_date=20250407T142103, end_date=20250407T142122
[2025-04-07T14:21:22.082+0000] {standard_task_runner.py:107} ERROR - Failed to execute job 12 for task predict_fraud (⚠️ predict_new.py завершился с ошибкой; 554)
[2025-04-07T14:21:22.102+0000] {local_task_job_runner.py:234} INFO - Task exited with return code 1
[2025-04-07T14:21:22.110+0000] {taskinstance.py:3280} INFO - 0 downstream tasks scheduled from follow-on schedule check
